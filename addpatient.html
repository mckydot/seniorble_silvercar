<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Seniorble - 환자 등록</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/add_patient.css">
</head>
<body>
    <!-- 상단 네비게이션 바 -->
    <nav class="mobile-nav">
        <button class="back-btn" onclick="goBack()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
        </button>
        <h1 class="nav-title">환자 등록</h1>
        <div class="nav-spacer"></div>
    </nav>

    <div class="container">
        <div class="patient-card">
            <!-- 안내 아이콘 및 텍스트 -->
            <div class="info-section">
                <div class="info-icon">👴👵</div>
                <h2 class="info-title">새 환자 등록</h2>
                <p class="info-description">
                    관리할 환자 정보와 센서 장치를 등록하세요.<br>
                    등록된 환자의 낙상 감지 알림을 받을 수 있습니다.
                </p>
            </div>

            <!-- 환자 등록 폼 -->
            <form id="addPatientForm">
                <!-- 환자 이름 -->
                <div class="form-group">
                    <label for="patientName">환자 이름 *</label>
                    <div class="input-wrapper">
                        <input 
                            type="text" 
                            id="patientName" 
                            name="patientName"
                            placeholder="김철수" 
                            required>
                        <span class="input-icon">👤</span>
                    </div>
                </div>

                <!-- 생년월일 -->
                <div class="form-group">
                    <label for="birthdate">생년월일 *</label>
                    <div class="input-wrapper">
                        <input 
                            type="date" 
                            id="birthdate" 
                            name="birthdate"
                            required
                            min="1900-01-01">
                        <span class="input-icon">📅</span>
                    </div>
                    <small class="input-help">환자의 나이를 확인하기 위해 필요합니다</small>
                </div>

                <!-- 성별 -->
                <div class="form-group">
                    <label for="gender">성별 *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="gender" value="male" required>
                            <span class="radio-label">남성</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="gender" value="female" required>
                            <span class="radio-label">여성</span>
                        </label>
                    </div>
                </div>

                <!-- 센서 시리얼 번호 -->
                <div class="form-group">
                    <label for="deviceSerial">센서 시리얼 번호 *</label>
                    <div class="input-wrapper">
                        <input 
                            type="text" 
                            id="deviceSerial" 
                            name="deviceSerial"
                            placeholder="SN-ABC123456789" 
                            required>
                        <span class="input-icon">🔢</span>
                    </div>
                    <small class="input-help">
                        센서 장치 뒷면에 기재된 시리얼 번호를 입력하세요
                    </small>
                </div>

                <!-- 특이사항/메모 -->
                <div class="form-group">
                    <label for="notes">특이사항 및 메모</label>
                    <textarea 
                        id="notes" 
                        name="notes"
                        placeholder="예) 고혈압, 무릎 수술 이력, 복용 중인 약 등&#10;환자 관리에 필요한 특이사항을 입력하세요."
                        rows="4"></textarea>
                    <small class="input-help">선택사항 - 의료 정보나 주의사항을 기록할 수 있습니다</small>
                </div>

                <!-- 보호자 관계 -->
                <div class="form-group">
                    <label for="relationship">환자와의 관계 *</label>
                    <!-- 커스텀 드롭다운 -->
                    <div class="custom-select-wrapper" id="relationshipWrapper">
                        <div class="custom-select" id="customSelect">
                            <div class="select-selected">선택하세요</div>
                        </div>
                        <!-- 실제 폼 전송용 hidden input -->
                        <input type="hidden" id="relationship" name="relationship" required>
                    </div>
                </div>

                <!-- 기타 관계 직접 입력 (기타 선택 시에만 표시) -->
                <div class="form-group" id="otherRelationshipGroup" style="display: none;">
                    <label for="otherRelationship">관계 입력 *</label>
                    <div class="input-wrapper">
                        <input 
                            type="text" 
                            id="otherRelationship" 
                            name="otherRelationship"
                            placeholder="예) 조카, 친구, 이웃 등" 
                            maxlength="20">
                        <span class="input-icon">✏️</span>
                    </div>
                    <small class="input-help">환자와의 관계를 직접 입력하세요 (최대 20자)</small>
                </div>

                <!-- 에러 메시지 표시 영역 -->
                <div id="errorMessage" class="error-message hidden"></div>

                <!-- 등록 버튼 -->
                <button type="submit" class="submit-button" id="submitBtn">
                    환자 등록하기
                </button>
            </form>

            <!-- 도움말 섹션 -->
            <div class="help-section">
                <p class="help-title">💡 센서 시리얼 번호를 찾을 수 없나요?</p>
                <p class="help-text">
                    센서 장치 뒷면 또는 포장 박스에서 "SN-"으로 시작하는 
                    번호를 확인하세요. 문의사항은 고객센터(1588-0000)로 연락주세요.
                </p>
            </div>
        </div>
    </div>

    <!-- 로딩 오버레이 -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p>환자 등록 중...</p>
    </div>

    <!-- 성공 모달 -->
    <div id="successModal" class="modal hidden">
        <div class="modal-content">
            <div class="success-icon">✓</div>
            <h3>등록 완료!</h3>
            <p id="successMessage">환자가 성공적으로 등록되었습니다.</p>
            <button class="modal-btn" onclick="goToHome()">확인</button>
        </div>
    </div>

    <!-- 드롭다운 옵션 목록 (포털 - body 직계 자식으로 배치하여 z-index 문제 해결) -->
    <div class="select-items hidden" id="selectItems">
        <div class="select-item" data-value="">선택하세요</div>
        <div class="select-item" data-value="son">아들</div>
        <div class="select-item" data-value="daughter">딸</div>
        <div class="select-item" data-value="spouse">배우자</div>
        <div class="select-item" data-value="grandson">손자</div>
        <div class="select-item" data-value="granddaughter">손녀</div>
        <div class="select-item" data-value="caregiver">요양보호사</div>
        <div class="select-item" data-value="other">기타</div>
    </div>

    <!-- JavaScript 파일 연결 -->
    <script src="./js/add_patient.js"></script>
</body>
</html>